@model List<ClaimSystem.Models.Claim>
@using ClaimSystem.Models

@*
    this view was developed with the assisntace from AI tools
*@

@{
    ViewData["Title"] = "Coordinator/Manager Review";
}
<div class="card p-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center gap-2">
            <span class="icon-pill"><i class="bi bi-clipboard-check"></i></span>
            <h1 class="h3 brand-serif mb-0">Programme Coordinator / Academic Manager — Review</h1>
        </div>
        <div class="d-flex gap-2">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input id="searchBox" class="form-control" placeholder="Search lecturer or month">
            </div>
            <select id="statusFilter" class="form-select" style="max-width:200px">
                <option value="">All statuses</option>
                <option value="Submitted">Submitted</option>
                <option value="PendingReview">PendingReview</option>
                <option value="Approved">Approved</option>
                <option value="Rejected">Rejected</option>
            </select>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table align-middle mb-0" id="claimsTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Lecturer</th>
                    <th>Month</th>
                    <th>Hours</th>
                    <th>Rate</th>
                    <th>Amount</th>
                    <th>Attachment</th>
                    <th>Status</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var c in Model)
                {
                    var badge = c.Status switch
                    {
                        ClaimStatus.Approved => "badge badge-success",
                        ClaimStatus.Rejected => "badge badge-danger",
                        ClaimStatus.PendingReview => "badge badge-warning",
                        ClaimStatus.Submitted => "badge badge-warning",
                        _ => "badge"
                    };
                    <tr data-name="@c.LecturerName" data-month="@c.Month" data-status="@c.Status">
                        <td>@c.Id</td>
                        <td>@c.LecturerName</td>
                        <td>@c.Month</td>
                        <td>@c.HoursWorked</td>
                        <td>R @c.HourlyRate</td>
                        <td>R @c.CalculatedAmount</td>
                        <td>@(string.IsNullOrWhiteSpace(c.AttachmentFileName) ? "-" : c.AttachmentFileName)</td>
                        <td><span class="@badge">@c.Status</span></td>
                        <td class="text-end">
                            <button class="btn btn-olive btn-sm" data-bs-toggle="modal" data-bs-target="#approveModal">
                                <i class="bi bi-check-lg me-1"></i>Approve
                            </button>
                            <button class="btn btn-ghost btn-sm" data-bs-toggle="modal" data-bs-target="#rejectModal">
                                <i class="bi bi-x-lg me-1 text-danger"></i>Reject
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


<div class="modal fade" id="approveModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title brand-serif"><i class="bi bi-check2-circle me-2 text-olive"></i>Approved</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">✅ Claim approved — the lecturer will be notified.</div>
            <div class="modal-footer"><button class="btn btn-mint" data-bs-dismiss="modal">OK</button></div>
        </div>
    </div>
</div>

<div class="modal fade" id="rejectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title brand-serif"><i class="bi bi-x-octagon me-2 text-danger"></i>Rejected</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">⚠️ Rejection noted.</div>
            <div class="modal-footer"><button class="btn btn-ghost" data-bs-dismiss="modal">OK</button></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const q = document.getElementById('searchBox');
        const f = document.getElementById('statusFilter');
        const rows = () => Array.from(document.querySelectorAll('#claimsTable tbody tr'));
        function applyFilters(){
          const term = (q.value||"").toLowerCase();
          const stat = f.value;
          rows().forEach(r=>{
            const okText = !term || r.dataset.name.toLowerCase().includes(term) || r.dataset.month.toLowerCase().includes(term);
            const okStatus = !stat || r.dataset.status === stat;
            r.style.display = (okText && okStatus) ? "" : "none";
          });
        }
        q.addEventListener('input', applyFilters);
        f.addEventListener('change', applyFilters);
    </script>
}

